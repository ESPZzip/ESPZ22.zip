SP<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>ESPZ</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f2f2f2; }
    header { background: #333; color: white; padding: 10px; display: flex; justify-content: space-between; }
    nav button { margin: 5px; }
    .section { display: none; padding: 20px; }
    .active { display: block; }
    .item-card { display: inline-block; border: 1px solid #ccc; padding: 10px; margin: 10px; background: white; border-radius: 10px; }
    .card { border: 1px solid #ddd; padding: 10px; margin: 10px; border-radius: 10px; background: #fff; }
    #adminPanel { display: none; position: fixed; top: 10%; left: 20%; width: 60%; background: white; border: 2px solid #333; padding: 20px; z-index: 1000; }
    #inventoryContainer img { border-radius: 8px; }
  </style>
</head>
<body>
  <header>
    <div id="playerName"></div>
    <div>Robux: <span id="playerRobux">0</span></div>
  </header>

  <nav>
    <button onclick="showSection('trades')">Trades</button>
    <button onclick="showSection('inventory')">Inventory</button>
    <button onclick="showSection('marketplace')">Marketplace</button>
    <button onclick="showSection('profile')">Profile</button>
    <button onclick="showSection('friends')">Friends</button>
  </nav>

  <main>
    <div id="trades" class="section">Sistema de trades pronto...</div>
    <div id="inventory" class="section">
      <h2>Inventario</h2>
      <div id="inventoryContainer"></div>
    </div>
    <div id="marketplace" class="section">
      <h2>Marketplace</h2>
      <div id="marketContainer"></div>
    </div>
    <div id="profile" class="section">
      <h2>Perfil</h2>
      <div id="profileContainer"></div>
    </div>
    <div id="friends" class="section">
      <h2>Amigos</h2>
      <input id="searchFriend" placeholder="Buscar usuario">
      <button onclick="searchFriend()">Buscar</button>
      <div id="friendResults"></div>
    </div>
  </main>

  <!-- Panel de Admin -->
  <div id="adminPanel">
    <h2>Panel de Admin</h2>

    <h4>Agregar Robux a mí mismo</h4>
    <input type="number" id="selfRobux" placeholder="Cantidad">
    <button onclick="addRobuxSelf()">Agregar</button>

    <h4>Dar Robux a Usuario</h4>
    <input id="targetUser" placeholder="Nombre de usuario">
    <input type="number" id="targetRobux" placeholder="Cantidad">
    <button onclick="giveRobuxToUser()">Dar Robux</button>

    <hr>
    <h4>Agregar ítem al Marketplace</h4>
    <input id="newItemName" placeholder="Nombre del ítem">
    <input id="newItemImg" placeholder="URL de imagen">
    <input type="number" id="newItemPrice" placeholder="Precio en Robux">
    <input type="number" id="newItemStock" placeholder="Stock">
    <button onclick="addItem()">Agregar ítem</button>

    <hr>
    <h4>Eliminar ítem del Marketplace</h4>
    <input id="removeItemId" placeholder="ID o Nombre del ítem">
    <button onclick="removeItem()">Eliminar ítem</button>

    <hr>
    <h4>Historial de acciones</h4>
    <div id="adminLog"></div>

    <button onclick="closeAdminPanel()">Cerrar</button>
  </div>

  <script>
    // ------------------ Datos ------------------
    function getUsers(){ return JSON.parse(localStorage.getItem("users")||"{}"); }
    function saveUsers(u){ localStorage.setItem("users",JSON.stringify(u)); }
    function getItems(){ return JSON.parse(localStorage.getItem("items")||"[]"); }
    function saveItems(i){ localStorage.setItem("items",JSON.stringify(i)); }

    // ------------------ Navegación ------------------
    function showSection(id){
      document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
      document.getElementById(id).classList.add("active");
      if(id==="inventory") renderInventory();
      if(id==="marketplace") renderMarketplace();
      if(id==="profile") renderProfile();
    }

    // ------------------ Inventory ------------------
    function renderInventory(){
      const c=document.getElementById("inventoryContainer"); 
      c.innerHTML="";
      const u=localStorage.getItem("currentUser");
      const users=getUsers(); 
      const items=getItems(); 
      const inv=users[u].inventory||[];

      if(inv.length===0){ 
        c.innerHTML="<p>No tienes ítems.</p>"; 
        return; 
      }

      inv.forEach(it=>{
        const item=items.find(i=>i.id===it);
        const d=document.createElement("div"); 
        d.className="item-card";

        if(item){
          d.innerHTML=`<img src="${item.img}" width="80"><h4>${item.name}</h4>`;
        } else {
          d.innerHTML=`<img src="https://via.placeholder.com/80?text=Retirado" width="80">
                       <h4>Edición retirada</h4>`;
        }

        c.appendChild(d);
      });
    }

    // ------------------ Marketplace ------------------
    function renderMarketplace(){
      const c=document.getElementById("marketContainer");
      c.innerHTML="";
      const items=getItems();
      items.forEach(it=>{
        const d=document.createElement("div");
        d.className="item-card";
        d.innerHTML=`<img src="${it.img}" width="80">
                     <h4>${it.name}</h4>
                     <p>${it.price} Robux</p>
                     <p>Stock: ${it.stock}</p>
                     <button onclick="buyItem('${it.id}')">Comprar</button>`;
        c.appendChild(d);
      });
    }

    function buyItem(itemId){
      const username=localStorage.getItem("currentUser");
      let users=getUsers();
      let user=users[username];
      let items=getItems();
      const index=items.findIndex(i=>i.id===itemId);
      const item=items[index];

      if(!item){ alert("El ítem no existe."); return; }
      if(user.robux<item.price){ alert("Robux insuficientes"); return; }
      if(item.stock<=0){ alert("Agotado"); return; }

      user.robux-=item.price;
      user.inventory=user.inventory||[];
      user.inventory.push(itemId);
      items[index].stock--;

      saveUsers(users); 
      saveItems(items);

      document.getElementById("playerRobux").textContent=user.robux;
      renderMarketplace(); 
      renderInventory();

      alert("Has comprado "+item.name+"!");
    }

    // ------------------ Profile ------------------
    function renderProfile(){
      const c=document.getElementById("profileContainer");
      const u=localStorage.getItem("currentUser");
      const users=getUsers();
      const user=users[u];
      c.innerHTML=`<div class="card"><h3>${u}</h3><p>Robux: ${user.robux}</p></div>`;
    }

    // ------------------ Friends ------------------
    function searchFriend(){
      const q=document.getElementById("searchFriend").value.trim().toLowerCase();
      const results=document.getElementById("friendResults");
      results.innerHTML="";
      const users=getUsers();
      Object.keys(users).forEach(u=>{
        if(u.toLowerCase()===q){
          results.innerHTML=`<div class="card"><h4>${u}</h4><button>Enviar solicitud</button></div>`;
        }
      });
      if(results.innerHTML==="") results.innerHTML="<p>Usuario no encontrado</p>";
    }

    // ------------------ Admin Panel ------------------
    function logAction(msg){
      const log=document.getElementById("adminLog");
      const p=document.createElement("p");
      p.textContent=msg;
      log.appendChild(p);
    }

    function addRobuxSelf(){
      const amt=parseInt(document.getElementById("selfRobux").value);
      const u=localStorage.getItem("currentUser");
      let users=getUsers();
      if(isNaN(amt)||amt<=0){ alert("Cantidad inválida"); return; }
      users[u].robux+=amt;
      saveUsers(users);
      document.getElementById("playerRobux").textContent=users[u].robux;
      logAction(`Se agregaron ${amt} robux a ${u}`);
    }

    function giveRobuxToUser(){
      const usernameInput=document.getElementById("targetUser").value.trim();
      const robuxToGive=parseInt(document.getElementById("targetRobux").value);

      if(!usernameInput||isNaN(robuxToGive)||robuxToGive<=0){
        alert("Debes escribir un nombre válido y una cantidad positiva."); return;
      }

      let users=getUsers();
      let foundUserKey=Object.keys(users).find(
        key=>key.toLowerCase()===usernameInput.toLowerCase()
      );

      if(!foundUserKey){ alert("Ese usuario no existe."); return; }

      users[foundUserKey].robux+=robuxToGive;
      saveUsers(users);

      const currentUser=localStorage.getItem("currentUser");
      if(foundUserKey===currentUser){
        document.getElementById("playerRobux").textContent=users[currentUser].robux;
      }

      logAction(`Se dieron ${robuxToGive} robux a ${foundUserKey}`);
      alert(`Has dado ${robuxToGive} robux a ${foundUserKey}`);
    }

    function addItem(){
      const name=document.getElementById("newItemName").value;
      const img=document.getElementById("newItemImg").value;
      const price=parseInt(document.getElementById("newItemPrice").value);
      const stock=parseInt(document.getElementById("newItemStock").value);

      if(!name||!img||isNaN(price)||isNaN(stock)){ alert("Datos inválidos"); return; }

      let items=getItems();
      const id=name.toLowerCase().replace(/\s+/g,"_")+"_"+Date.now();
      items.push({id,name,img,price,stock});
      saveItems(items);
      renderMarketplace();
      logAction(`Se agregó el ítem '${name}' con stock ${stock}`);
    }

    function removeItem(){
      const query=document.getElementById("removeItemId").value.trim().toLowerCase();
      if(!query){ alert("Debes escribir el ID o nombre del ítem."); return; }
      let items=getItems();
      const index=items.findIndex(it=>it.id.toLowerCase()===query||it.name.toLowerCase()===query);
      if(index===-1){ alert("No se encontró ningún ítem."); return; }
      const removed=items.splice(index,1)[0];
      saveItems(items);
      renderMarketplace();
      logAction(`Se eliminó el ítem '${removed.name}' (${removed.id})`);
      alert(`Ítem '${removed.name}' eliminado correctamente.`);
    }

    function closeAdminPanel(){ document.getElementById("adminPanel").style.display="none"; }

    // ------------------ Inicialización ------------------
    window.onload=function(){
      const u=localStorage.getItem("currentUser");
      if(!u){ alert("Debes registrarte o iniciar sesión primero."); return; }
      const users=getUsers();
      document.getElementById("playerName").textContent=u;
      document.getElementById("playerRobux").textContent=users[u].robux;
      showSection("marketplace");
    };

    document.addEventListener("keydown",function(e){
      const u=localStorage.getItem("currentUser");
      if(e.key==="F9"&&u==="ROBLOX"){
        const p=document.getElementById("adminPanel");
        p.style.display=(p.style.display==="block")?"none":"block";
      }
    });
  </script>
</body>
</html>
