<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>ESP:Z COINS - Cajas Roblox</title>
  <style>
    body { font-family: Arial, sans-serif; background:#111; color:#fff; margin:0; padding:0; text-align:center; }
    header { background:#222; padding:15px; font-size:26px; }
    .coins { margin:20px; font-size:22px; }
    .container { display:flex; justify-content:center; gap:30px; margin:20px; flex-wrap:wrap; }
    .box { background:#222; padding:20px; border-radius:15px; width:220px; }
    .box img { width:180px; height:180px; object-fit:contain; margin-bottom:10px; }
    .box h2 { font-size:20px; margin-bottom:10px; }
    .box button { margin-top:10px; padding:10px 15px; border:none; border-radius:8px; background:#28a745; color:#fff; cursor:pointer; font-size:16px; display:block; width:100%; }
    .inventory { padding:20px; background:#222; margin:20px; border-radius:15px; }
    .inventory h2 { margin-bottom:10px; }
    .inventory-items { display:flex; flex-wrap:wrap; gap:15px; justify-content:center; }
    .item { background:#333; padding:10px; border-radius:8px; width:120px; }
    .item img { width:100px; height:100px; object-fit:contain; }
    .rarity-común { color:lightgray; }
    .rarity-raro { color:#4da6ff; }
    .rarity-épico { color:#b84dff; }
    .rarity-legendario { color:gold; text-shadow:0 0 8px gold; }
    .sell-btn { margin-top:5px; padding:4px 8px; font-size:12px; cursor:pointer; background:#c00; border:none; border-radius:5px; color:white; }
    .sell-all-btn { margin-top:15px; padding:10px 15px; font-size:14px; cursor:pointer; background:#e67e22; border:none; border-radius:8px; color:white; }
    #itemModal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); justify-content:center; align-items:center; }
    #itemModal .modal-content { background:#222; padding:20px; border-radius:10px; max-width:600px; max-height:80%; overflow-y:auto; color:#fff; }
  </style>
</head>
<body>
  <header>ESP:Z COINS - Cajas Roblox</header>
  <div class="coins">Monedas: <span id="coins">0</span></div>

  <div class="container">
    <!-- Caja Básica -->
    <div class="box">
      <img src="https://media.discordapp.net/attachments/1412227402414821426/1412580654931251301/P7ryoBP.png" alt="Caja Básica">
      <h2>Caja Básica - 150 monedas</h2>
      <button onclick="openBox('basic')">Abrir</button>
      <button onclick="showItems('basic')">Ver ítems</button>
    </div>

    <!-- Caja Épica -->
    <div class="box">
      <img src="https://media.discordapp.net/attachments/1412227402414821426/1412574672939126824/TsnB7J6.png" alt="Caja Épica">
      <h2>Caja Épica - 1200 monedas</h2>
      <button onclick="openBox('epic')">Abrir</button>
      <button onclick="showItems('epic')">Ver ítems</button>
    </div>

    <!-- Caja Cracky -->
    <div class="box">
      <img src="https://media.discordapp.net/attachments/1412227402414821426/1412577203748733038/Ez7wbts.png" alt="Caja Cracky">
      <h2>CAJA CRACKY (Especial) - 100,000 monedas</h2>
      <button onclick="openBox('cracky')">Abrir</button>
      <button onclick="showItems('cracky')">Ver ítems</button>
    </div>
  </div>

  <div class="inventory">
    <h2>Inventario</h2>
    <div class="inventory-items" id="inventory"></div>
    <button class="sell-all-btn" onclick="sellAll()">Vender todos</button>
  </div>

  <div style="margin:20px;">
    <h2>Canjear Código</h2>
    <input type="text" id="codeInput" placeholder="Escribe tu código aquí">
    <button onclick="redeemCode()">Canjear</button>
  </div>

  <!-- Modal -->
  <div id="itemModal">
    <div class="modal-content">
      <h2 id="modalTitle">Ítems</h2>
      <div id="modalContent"></div>
      <button onclick="closeModal()">Cerrar</button>
    </div>
  </div>

  <script>
    let coins = parseInt(localStorage.getItem('coins')) || 2500;
    let inventory = JSON.parse(localStorage.getItem('inventory')) || [];
    let codesUsed = JSON.parse(localStorage.getItem('codesUsed')) || {};

    document.getElementById("coins").innerText = coins;

    const boxes = {
      basic: {
        name: "Caja Básica",
        price: 150,
        items: [
          { name:"Classic Fedora", value:200, prob:0.5, rarity:"común", img:"https://tr.rbxcdn.com/30DAY-3a6c7ffb5ec1fbe3c9b514cfa4737860/420/420/Hat/Webp/noFilter" },
          { name:"Red Roblox Cap", value:500, prob:0.3, rarity:"raro", img:"https://tr.rbxcdn.com/30DAY-6d6a23f7b47e6a2b05682d1830f4a9b1/420/420/Hat/Webp/noFilter" },
          { name:"Shaggy", value:2000, prob:0.2, rarity:"épico", img:"https://tr.rbxcdn.com/30DAY-8c0a21ad62c26f350c89072c04d79d97/420/420/Hat/Webp/noFilter" }
        ]
      },
      epic: {
        name: "Caja Épica",
        price: 1200,
        items: [
          { name:"Valkyrie Helm", value:10000, prob:0.5, rarity:"épico", img:"https://tr.rbxcdn.com/30DAY-b730d6e9f65d9eebfdbeed52b21965b8/420/420/Hat/Webp/noFilter" },
          { name:"Sparkle Time Fedora", value:20000, prob:0.3, rarity:"legendario", img:"https://tr.rbxcdn.com/30DAY-00e55f53d6f8ec65aa2184141f1999c3/420/420/Hat/Webp/noFilter" },
          { name:"Dominus Aureus", value:50000, prob:0.05, rarity:"legendario", img:"https://tr.rbxcdn.com/30DAY-24a0cfbc7c4b93aeeeb7bc01db57a97c/420/420/Hat/Webp/noFilter" }
        ]
      },
      cracky: {
        name: "Caja Cracky",
        price: 100000,
        items: [
          { name:"Cracky Hat", value:250000, prob:0.001, rarity:"legendario", img:"https://tr.rbxcdn.com/30DAY-3de1a12a6e72bb6a1e536cb6bff02d9c/420/420/Hat/Webp/noFilter" },
          { name:"Cracky Face", value:10000, prob:0.5, rarity:"raro", img:"https://tr.rbxcdn.com/30DAY-8708c8e90f7c763ff04bb4eebabb9df0/420/420/Face/Webp/noFilter" },
          { name:"Cracky Mods", value:50000, prob:0.2, rarity:"épico", img:"https://tr.rbxcdn.com/30DAY-9de6f14d3ef9c601fc7d0c99364a3b5d/420/420/Accessory/Webp/noFilter" }
        ]
      }
    };

    function save() {
      localStorage.setItem('coins', coins);
      localStorage.setItem('inventory', JSON.stringify(inventory));
      localStorage.setItem('codesUsed', JSON.stringify(codesUsed));
    }

    function openBox(type) {
      const box = boxes[type];
      if (coins < box.price) { alert("No tienes suficientes monedas."); return; }
      coins -= box.price;
      document.getElementById("coins").innerText = coins;

      let rand = Math.random();
      let cumulative = 0;
      for (let item of box.items) {
        cumulative += item.prob;
        if (rand <= cumulative) {
          inventory.push(item);
          alert("¡Ganaste: " + item.name + "!");
          break;
        }
      }
      renderInventory();
      save();
    }

    function renderInventory() {
      const inv = document.getElementById("inventory");
      inv.innerHTML = "";
      inventory.forEach((it, idx) => {
        let div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `
          <img src="${it.img}" alt="${it.name}">
          <div class="rarity-${it.rarity}">${it.name}</div>
          <small>Valor: ${it.value}</small><br>
          <button class="sell-btn" onclick="sellItem(${idx})">Vender</button>
        `;
        inv.appendChild(div);
      });
    }
    renderInventory();

    function sellItem(i) {
      let item = inventory[i];
      coins += item.value;
      inventory.splice(i, 1);
      document.getElementById("coins").innerText = coins;
      renderInventory();
      save();
    }

    function sellAll() {
      let total = inventory.reduce((sum, it) => sum + it.value, 0);
      if (total === 0) { alert("No tienes ítems."); return; }
      coins += total;
      inventory = [];
      document.getElementById("coins").innerText = coins;
      renderInventory();
      save();
      alert("Vendiste todos tus ítems por " + total + " monedas.");
    }

    function redeemCode() {
      const input = document.getElementById("codeInput").value.trim().toUpperCase();
      if (!input) return;
      if (codesUsed[input]) { alert("Ya usaste este código."); return; }

      if (input === "CRACKYRECOMPENSE") {
        coins += 50000;
        alert("¡Código canjeado! Ganaste 50,000 monedas.");
        codesUsed[input] = true;
      } else {
        alert("Código inválido.");
        return;
      }

      document.getElementById("coins").innerText = coins;
      save();
    }

    function showItems(type) {
      const box = boxes[type];
      document.getElementById("modalTitle").innerText = box.name;
      let html = "";
      box.items.forEach(it => {
        html += `
          <div style="margin:10px; background:#333; padding:10px; border-radius:8px;">
            <img src="${it.img}" style="width:80px; height:80px;"><br>
            <b>${it.name}</b><br>
            Valor: ${it.value} | Prob: ${(it.prob*100).toFixed(2)}%
          </div>
        `;
      });
      document.getElementById("modalContent").innerHTML = html;
      document.getElementById("itemModal").style.display = "flex";
    }

    function closeModal() {
      document.getElementById("itemModal").style.display = "none";
    }
  </script>
</body>
</html>
