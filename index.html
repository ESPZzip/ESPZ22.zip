<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>ESP:Z COINS - Cajas Roblox</title>
  <style>
    body { font-family: Arial, sans-serif; background: #111; color: #fff; text-align: center; }
    .box { border: 2px solid #444; padding: 10px; margin: 10px; display: inline-block; border-radius: 10px; background: #222; }
    button { padding: 8px 14px; margin: 5px; border-radius: 8px; border: none; cursor: pointer; }
    #inventory { margin-top: 20px; text-align: left; max-width: 600px; margin-left: auto; margin-right: auto; }
    #news { margin-top: 20px; background: #222; padding: 10px; border-radius: 10px; max-width: 600px; margin-left: auto; margin-right: auto; text-align: left; }
    .rarity-common { color: #bbb; }
    .rarity-rare { color: #3b82f6; }
    .rarity-epic { color: #a855f7; }
    .rarity-legendary { color: gold; animation: shine 2s infinite linear; }
    @keyframes shine {
      0% { text-shadow: 0 0 5px gold; }
      50% { text-shadow: 0 0 20px gold, 0 0 30px orange; }
      100% { text-shadow: 0 0 5px gold; }
    }
  </style>
</head>
<body>
  <h1>üéÅ ESP:Z COINS - Cajas Roblox</h1>
  <p>Monedas: <span id="coins">0</span></p>
  <div id="boxes"></div>
  <h2>üóÉÔ∏è Inventario</h2>
  <div id="inventory"></div>
  <button onclick="sellAll()">Vender Todo</button>
  <h2>üì∞ Noticias</h2>
  <div id="news"></div>
  <p id="dailyReward"></p>
  <p id="nextReward"></p>
  <p id="itemTimer"></p>

  <script>
    let coins = parseInt(localStorage.getItem('coins')) || 0;
    let inventory = JSON.parse(localStorage.getItem('inventory')) || [];
    let news = JSON.parse(localStorage.getItem('news')) || [];
    let lastDaily = localStorage.getItem('lastDaily') || null;
    let nextItemUpdate = localStorage.getItem('nextItemUpdate');

    const BOXES = [
      { name: "Caja B√°sica", price: 150, items: [
        {name: "Robux Coin", value: 100, prob: 50, rarity: "Com√∫n", icon:"‚ö™"},
        {name: "Noob Character", value: 150, prob: 30, rarity: "Com√∫n", icon:"‚ö™"},
        {name: "Roblox Shirt", value: 200, prob: 15, rarity: "Raro", icon:"üîπ"},
        {name: "Roblox Hat", value: 300, prob: 5, rarity: "Raro", icon:"üîπ"}
      ]},
      { name: "Caja √âpica", price: 1200, items: [
        {name: "Epic Roblox Sword", value: 800, prob: 40, rarity: "√âpico", icon:"üíé"},
        {name: "Golden Robux", value: 1000, prob: 30, rarity: "√âpico", icon:"üíé"},
        {name: "Red Valkyrie", value: 1200, prob: 20, rarity: "Legendario", icon:"‚≠ê"},
        {name: "Dominus", value: 1500, prob: 10, rarity: "Legendario", icon:"‚≠ê"}
      ]}
    ];

    function save(){
      localStorage.setItem('coins', coins);
      localStorage.setItem('inventory', JSON.stringify(inventory));
      localStorage.setItem('news', JSON.stringify(news));
    }

    function render(){
      document.getElementById('coins').textContent = coins;
      let invHTML = "";
      inventory.forEach((item,i)=>{
        let cls = rarityClass(item.rarity);
        invHTML += `<div class="${cls}">${item.icon} ${item.name} (${item.rarity}) - Valor: ${item.value} <button onclick="sellItem(${i})">Vender</button></div>`;
      });
      document.getElementById('inventory').innerHTML = invHTML;

      let newsHTML = news.map(n => `<div>${n}</div>`).join('');
      document.getElementById('news').innerHTML = newsHTML;

      let boxesHTML = BOXES.map((b,i)=> `<div class='box'><h3>${b.name}</h3><p>Precio: ${b.price}</p><button onclick='openBox(${i})'>Abrir</button></div>`).join('');
      document.getElementById('boxes').innerHTML = boxesHTML;
    }

    function rarityClass(rarity){
      switch(rarity){
        case "Com√∫n": return "rarity-common";
        case "Raro": return "rarity-rare";
        case "√âpico": return "rarity-epic";
        case "Legendario": return "rarity-legendary";
        default: return "";
      }
    }

    function openBox(i){
      let box = BOXES[i];
      if(coins < box.price){ alert("No tienes suficientes monedas"); return; }
      coins -= box.price;
      let item = getRandomItem(box.items);
      inventory.push(item);
      news.unshift(`Ganaste ${item.icon} <span class='${rarityClass(item.rarity)}'>${item.name} (${item.rarity})</span>`);
      save();
      render();
    }

    function getRandomItem(items){
      let totalProb = items.reduce((a,b)=>a+b.prob,0);
      let rand = Math.random()*totalProb;
      let cumulative = 0;
      for(let item of items){
        cumulative += item.prob;
        if(rand <= cumulative){
          return {...item};
        }
      }
    }

    function sellItem(i){
      let item = inventory[i];
      if(confirm(`¬øVender ${item.name} (${item.rarity}) por ${item.value} monedas?`)){
        coins += item.value;
        inventory.splice(i,1);
        save();
        render();
      }
    }

    function sellAll(){
      let total = inventory.reduce((a,b)=>a+b.value,0);
      if(confirm(`¬øVender todo por ${total} monedas?`)){
        coins += total;
        inventory = [];
        save();
        render();
      }
    }

    // Recompensa diaria
    function dailyReward(){
      let today = new Date().toDateString();
      if(lastDaily !== today){
        coins += 2500;
        lastDaily = today;
        localStorage.setItem('lastDaily', lastDaily);
        alert("Has recibido 2500 ESP:Z COINS por recompensa diaria!");
      }
    }

    // Actualizaci√≥n de √≠tems cada 20 min
    const EXTRA_ITEMS = [
      {name:"Rainbow Dominus", value:2000, prob:5, rarity:"Legendario", icon:"‚≠ê"},
      {name:"Ban Hammer", value:1800, prob:10, rarity:"Legendario", icon:"‚≠ê"},
      {name:"Roblox Fedora", value:900, prob:30, rarity:"√âpico", icon:"üíé"},
      {name:"Builder‚Äôs Hat", value:700, prob:35, rarity:"Raro", icon:"üîπ"},
      {name:"Bloxy Award", value:2200, prob:20, rarity:"Legendario", icon:"‚≠ê"}
    ];

    function updateItems(){
      BOXES.forEach(b=> b.items.push({...EXTRA_ITEMS[Math.floor(Math.random()*EXTRA_ITEMS.length)], expires: Date.now()+3600000 }));
      news.unshift("Nuevos √≠tems a√±adidos a las cajas!");
      nextItemUpdate = Date.now() + 20*60*1000;
      localStorage.setItem('nextItemUpdate', nextItemUpdate);
      save();
      render();
    }

    function checkItemExpiry(){
      BOXES.forEach(b=>{
        b.items = b.items.filter(item=>{
          if(item.expires && Date.now()>item.expires){
            let exclusiveItem = {...item, name: item.name+" [EXCLUSIVO]", value: item.value*2};
            inventory.push(exclusiveItem);
            alert(`El √≠tem ${item.name} expir√≥ de las cajas y se guard√≥ en tu inventario como EXCLUSIVO!`);
            return false;
          }
          return true;
        });
      });
      save();
      render();
    }

    function tick(){
      let now = Date.now();
      if(nextItemUpdate && now >= nextItemUpdate){ updateItems(); }
      if(nextItemUpdate){
        let diff = nextItemUpdate - now;
        if(diff>0){
          let m = Math.floor(diff/60000), s=Math.floor((diff%60000)/1000);
          document.getElementById('itemTimer').textContent = `Nuevos √≠tems en: ${m}m ${s}s`;
        }
      }
      checkItemExpiry();
    }

    dailyReward();
    setInterval(tick,1000);
    render();
  </script>
</body>
</html>
