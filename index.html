<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ESPZ</title>
  <style>
    body{
      margin:0;font-family:Arial,Helvetica,sans-serif;background:#f4f4f4;color:#222;
    }
    header{
      background:#202020;color:#fff;padding:10px 20px;display:flex;justify-content:space-between;align-items:center;
    }
    .brand{font-weight:bold;}
    .pill{background:#444;color:#fff;padding:5px 10px;border-radius:20px;}
    main{display:flex;}
    aside{
      width:200px;background:#eee;padding:10px;
    }
    .menu button{display:block;width:100%;padding:10px;margin:5px 0;border:none;background:#ddd;cursor:pointer;border-radius:6px;}
    .menu button.active{background:#bbb;}
    .content{flex:1;padding:20px;}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:15px;}
    .card{background:#fff;border:1px solid #ccc;border-radius:8px;overflow:hidden;box-shadow:0 2px 4px rgba(0,0,0,0.1)}
    .card img{width:100%;height:150px;object-fit:cover;}
    .card h4{margin:10px;}
    .card .meta{display:flex;justify-content:space-between;align-items:center;padding:10px;}
    .btn{padding:6px 12px;border:none;border-radius:6px;cursor:pointer;}
    .btn.primary{background:#007bff;color:#fff;}
    .btn.success{background:#28a745;color:#fff;}
    .btn.danger{background:#dc3545;color:#fff;}
    .btn:disabled{opacity:.6;cursor:not-allowed;}
    .hidden{display:none;}
    /* Modal */
    .modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;}
    .modal .box{background:#fff;padding:20px;border-radius:8px;max-width:400px;width:100%;}
    .modal h3{margin-top:0;}
    .toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:#333;color:#fff;padding:10px 20px;border-radius:6px;display:none;}
  </style>
</head>
<body>
  <header>
    <div class="brand">ESPZ DEMO</div>
    <div>
      <span id="playerName">Invitado</span>
      <span class="pill">Robux: <span id="robuxBalance">0</span></span>
      <button id="btnLogin" class="btn primary">Login/Registro</button>
      <button id="btnLogout" class="btn danger hidden">Salir</button>
    </div>
  </header>

  <main>
    <aside>
      <div class="menu">
        <button data-view="marketplace" class="active">Marketplace</button>
        <button data-view="inventory">Inventory</button>
        <button data-view="trades">Trades</button>
        <button data-view="profile">Profile</button>
        <button data-view="friends">Friends</button>
      </div>
    </aside>
    <section class="content">
      <div id="view-marketplace" class="view">
        <h2>Marketplace</h2>
        <div id="marketGrid" class="grid"></div>
      </div>
      <div id="view-inventory" class="view hidden">
        <h2>Inventory</h2>
        <div id="inventoryGrid" class="grid"></div>
        <p id="emptyInventory">No tienes objetos</p>
      </div>
      <div id="view-trades" class="view hidden">
        <h2>Trades</h2>
        <p>Pendiente...</p>
      </div>
      <div id="view-profile" class="view hidden">
        <h2>Profile</h2>
        <p><strong>Usuario:</strong> <span id="profileUsername"></span></p>
        <p><strong>Robux:</strong> <span id="profileRobux"></span></p>
        <button id="grantRobux" class="btn success">+100 Robux</button>
      </div>
      <div id="view-friends" class="view hidden">
        <h2>Friends</h2>
        <input id="friendSearch" placeholder="Buscar usuario..." />
        <button id="btnSearchFriend" class="btn">Buscar</button>
        <div id="friendResults" class="grid"></div>
      </div>
    </section>
  </main>

  <!-- Modal Confirm -->
  <div id="confirmModal" class="modal hidden">
    <div class="box">
      <h3>Confirmar compra</h3>
      <p id="confirmText">¿Deseas comprar este artículo?</p>
      <button id="confirmYes" class="btn success">Comprar</button>
      <button id="confirmNo" class="btn">Cancelar</button>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    const defaultItems=[
      {id:'1',name:'Classic Fedora',price:150,img:'https://via.placeholder.com/300x150?text=Classic+Fedora'},
      {id:'2',name:'Dominus Astra',price:1000,img:'https://via.placeholder.com/300x150?text=Dominus+Astra'},
      {id:'3',name:'Valkyrie Helm',price:750,img:'https://via.placeholder.com/300x150?text=Valkyrie+Helm'}
    ];

    const LS_USERS='demo_users';
    const LS_SESSION='demo_session';
    const getUsers=()=>JSON.parse(localStorage.getItem(LS_USERS)||'[]');
    const setUsers=a=>localStorage.setItem(LS_USERS,JSON.stringify(a));
    const getSession=()=>JSON.parse(localStorage.getItem(LS_SESSION)||'null');
    const setSession=o=>localStorage.setItem(LS_SESSION,JSON.stringify(o));

    const views={
      marketplace:document.getElementById('view-marketplace'),
      inventory:document.getElementById('view-inventory'),
      trades:document.getElementById('view-trades'),
      profile:document.getElementById('view-profile'),
      friends:document.getElementById('view-friends')
    };

    const marketGrid=document.getElementById('marketGrid');
    const inventoryGrid=document.getElementById('inventoryGrid');
    const emptyInventory=document.getElementById('emptyInventory');

    const playerName=document.getElementById('playerName');
    const robuxBalance=document.getElementById('robuxBalance');

    const btnLogin=document.getElementById('btnLogin');
    const btnLogout=document.getElementById('btnLogout');

    const confirmModal=document.getElementById('confirmModal');
    const confirmText=document.getElementById('confirmText');
    const confirmYes=document.getElementById('confirmYes');
    const confirmNo=document.getElementById('confirmNo');

    const toast=document.getElementById('toast');

    let pendingItem=null;

    function showView(v){Object.keys(views).forEach(k=>views[k].classList.add('hidden'));views[v].classList.remove('hidden');document.querySelectorAll('.menu button').forEach(b=>b.classList.toggle('active',b.dataset.view===v));}

    document.querySelector('.menu').addEventListener('click',e=>{if(e.target.tagName==='BUTTON'){showView(e.target.dataset.view);if(e.target.dataset.view==='inventory')renderInventory();if(e.target.dataset.view==='profile')renderProfile();}});

    function renderMarketplace(){marketGrid.innerHTML='';defaultItems.forEach(it=>{const owned=getCurrentUser()?.inventory?.some(x=>x.id===it.id);const div=document.createElement('div');div.className='card';div.innerHTML=`<img src="${it.img}" alt="${it.name}"><h4>${it.name}</h4><div class="meta"><span>${it.price} R$</span><button class="btn primary" data-buy="${it.id}" ${owned? 'disabled':''}>${owned?'Comprado':'Comprar'}</button></div>`;marketGrid.appendChild(div);});}

    function renderInventory(){const user=getCurrentUser();inventoryGrid.innerHTML='';if(!user||user.inventory.length===0){emptyInventory.style.display='block';return;}emptyInventory.style.display='none';user.inventory.forEach(it=>{const div=document.createElement('div');div.className='card';div.innerHTML=`<img src="${it.img}" alt="${it.name}"><h4>${it.name}</h4><div class="meta"><span>${it.price} R$</span><span>En propiedad</span></div>`;inventoryGrid.appendChild(div);});}

    function renderProfile(){const u=getCurrentUser();document.getElementById('profileUsername').textContent=u?.username||'';document.getElementById('profileRobux').textContent=u?.robux||0;}

    marketGrid.addEventListener('click',e=>{const btn=e.target.closest('button[data-buy]');if(!btn)return;const id=btn.getAttribute('data-buy');const item=defaultItems.find(i=>i.id===id);const u=getCurrentUser();if(!u){showToast('Inicia sesión primero');return;}if(u.inventory.some(x=>x.id===id)){showToast('Ya lo tienes');return;}pendingItem=item;confirmText.textContent=`¿Comprar ${item.name} por ${item.price} R$?`;confirmModal.classList.remove('hidden');});

    confirmYes.addEventListener('click',()=>{if(!pendingItem)return;const u=getCurrentUser();if(u.robux<pendingItem.price){showToast('Robux insuficientes');confirmModal.classList.add('hidden');return;}u.robux-=pendingItem.price;u.inventory.push(pendingItem);updateUser(u);applySession(u);showToast('Compra realizada');renderMarketplace();confirmModal.classList.add('hidden');pendingItem=null;});
    confirmNo.addEventListener('click',()=>{confirmModal.classList.add('hidden');pendingItem=null;});

    function showToast(msg){toast.textContent=msg;toast.style.display='block';setTimeout(()=>toast.style.display='none',2000);}

    function getCurrentUser(){const s=getSession();if(!s)return null;return getUsers().find(u=>u.username===s.username)||null;}
    function updateUser(u){const arr=getUsers();const idx=arr.findIndex(x=>x.username===u.username);if(idx>=0){arr[idx]=u;setUsers(arr);}}

    function applySession(u){if(u){playerName.textContent=u.username;robuxBalance.textContent=u.robux;btnLogin.classList.add('hidden');btnLogout.classList.remove('hidden');}else{playerName.textContent='Invitado';robuxBalance.textContent=0;btnLogin.classList.remove('hidden');btnLogout.classList.add('hidden');}renderMarketplace();}

    btnLogout.addEventListener('click',()=>{localStorage.removeItem(LS_SESSION);applySession(null);showToast('Sesión cerrada');});

    document.getElementById('grantRobux').addEventListener('click',()=>{const u=getCurrentUser();if(!u)return;u.robux+=100;updateUser(u);applySession(u);renderProfile();showToast('+100 Robux');});

    renderMarketplace();if(getSession())applySession(getCurrentUser());
  </script>
</body>
</html>
