<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>ESPZ</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #111;
      color: #fff;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #222;
      padding: 10px 20px;
    }
    #username {
      font-weight: bold;
    }
    #robux {
      font-weight: bold;
    }
    .container {
      display: flex;
    }
    nav {
      width: 200px;
      background: #1b1b1b;
      padding: 10px;
    }
    nav button {
      display: block;
      width: 100%;
      padding: 10px;
      margin: 5px 0;
      background: #333;
      color: #fff;
      border: none;
      cursor: pointer;
    }
    nav button:hover {
      background: #444;
    }
    main {
      flex: 1;
      padding: 20px;
    }
    .item {
      background: #222;
      padding: 10px;
      margin: 10px;
      display: inline-block;
      width: 150px;
      text-align: center;
      border-radius: 5px;
    }
    .item img {
      max-width: 100%;
    }
    .hidden {
      display: none;
    }
    #authModal, #buyModal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #authModalContent, #buyModalContent {
      background: #1b1b1b;
      padding: 20px;
      border-radius: 8px;
      width: 300px;
      text-align: center;
    }
    input {
      width: 90%;
      margin: 5px 0;
      padding: 8px;
    }
    button {
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>
    <div id="username">Invitado</div>
    <div>
      <span id="robux">💎 0</span>
      <button id="authBtn">Iniciar sesión / Registrarse</button>
    </div>
  </header>
  <div class="container">
    <nav>
      <button onclick="showSection('marketplace')">Marketplace</button>
      <button onclick="showSection('inventory')">Inventory</button>
      <button onclick="showSection('trades')">Trades</button>
      <button onclick="showSection('profile')">Profile</button>
      <button onclick="showSection('friends')">Friends</button>
    </nav>
    <main>
      <section id="marketplace" class="section">
        <h2>Marketplace</h2>
        <div id="items"></div>
      </section>
      <section id="inventory" class="section hidden">
        <h2>Inventory</h2>
        <ul id="inventoryList"></ul>
      </section>
      <section id="trades" class="section hidden">
        <h2>Trades</h2>
        <p>Aún en desarrollo.</p>
      </section>
      <section id="profile" class="section hidden">
        <h2>Profile</h2>
        <p id="profileInfo"></p>
        <button onclick="addRobux(100)">+100 Robux (demo)</button>
      </section>
      <section id="friends" class="section hidden">
        <h2>Friends</h2>
        <input type="text" id="friendSearch" placeholder="Buscar usuario..." />
        <button onclick="searchFriend()">Buscar</button>
        <ul id="friendsList"></ul>
      </section>
    </main>
  </div>

  <!-- Modal de autenticación -->
  <div id="authModal">
    <div id="authModalContent">
      <h3>Registro / Iniciar Sesión</h3>
      <input type="text" id="authUser" placeholder="Usuario" />
      <input type="password" id="authPass" placeholder="Contraseña" />
      <button onclick="register()">Registrarse</button>
      <button onclick="login()">Iniciar Sesión</button>
    </div>
  </div>

  <!-- Modal de compra -->
  <div id="buyModal" class="hidden">
    <div id="buyModalContent">
      <h3>Confirmar compra</h3>
      <p id="buyText"></p>
      <button onclick="confirmBuy()">Comprar</button>
      <button onclick="closeBuyModal()">Cancelar</button>
    </div>
  </div>

  <script>
    let currentUser = null;
    let users = JSON.parse(localStorage.getItem('users')) || {};
    let robux = 0;
    let inventory = [];
    let buyingItem = null;

    const items = [
      { name: 'Classic Fedora', price: 150, img: 'https://tr.rbxcdn.com/8d7b48c37a2f65f0a3bda8659f70903a/420/420/Hat/Webp' },
      { name: 'Valkyrie Helm', price: 750, img: 'https://tr.rbxcdn.com/87f739b6e70ecf62c802d5f3bcd4d1f9/420/420/Hat/Webp' },
      { name: 'Red Sparkle Time', price: 1200, img: 'https://tr.rbxcdn.com/f62c97b9a65db0a2b78ccaa6d6c1b03a/420/420/Hat/Webp' },
      { name: 'Top Hat', price: 500, img: 'https://tr.rbxcdn.com/56e0545d6e92db9275480a219c2f4780/420/420/Hat/Webp' }
    ];

    function renderItems() {
      const container = document.getElementById('items');
      container.innerHTML = '';
      items.forEach(item => {
        const div = document.createElement('div');
        div.className = 'item';
        div.innerHTML = `
          <img src="${item.img}" alt="${item.name}" />
          <h4>${item.name}</h4>
          <p>💎 ${item.price}</p>
          <button onclick='openBuyModal(${JSON.stringify(JSON.stringify(item))})'>Comprar</button>
        `;
        container.appendChild(div);
      });
    }

    function openBuyModal(itemStr) {
      buyingItem = JSON.parse(itemStr);
      document.getElementById('buyText').innerText = `¿Deseas comprar ${buyingItem.name} por ${buyingItem.price} Robux?`;
      document.getElementById('buyModal').classList.remove('hidden');
    }

    function closeBuyModal() {
      document.getElementById('buyModal').classList.add('hidden');
    }

    function confirmBuy() {
      if (robux >= buyingItem.price) {
        robux -= buyingItem.price;
        inventory.push(buyingItem);
        updateUI();
        alert('Compra realizada con éxito!');
      } else {
        alert('Robux insuficientes');
      }
      closeBuyModal();
    }

    function register() {
      const user = document.getElementById('authUser').value;
      const pass = document.getElementById('authPass').value;
      if (users[user]) {
        alert('Usuario ya existe');
        return;
      }
      users[user] = { pass, robux: 100, inventory: [], friends: [] };
      localStorage.setItem('users', JSON.stringify(users));
      currentUser = user;
      robux = 100;
      inventory = [];
      document.getElementById('authModal').style.display = 'none';
      updateUI();
    }

    function login() {
      const user = document.getElementById('authUser').value;
      const pass = document.getElementById('authPass').value;
      if (!users[user] || users[user].pass !== pass) {
        alert('Credenciales inválidas');
        return;
      }
      currentUser = user;
      robux = users[user].robux;
      inventory = users[user].inventory;
      document.getElementById('authModal').style.display = 'none';
      updateUI();
    }

    function updateUI() {
      document.getElementById('username').innerText = currentUser;
      document.getElementById('robux').innerText = `💎 ${robux}`;
      document.getElementById('inventoryList').innerHTML = inventory.map(i => `<li>${i.name}</li>`).join('');
      document.getElementById('profileInfo').innerText = `Usuario: ${currentUser}`;
      users[currentUser].robux = robux;
      users[currentUser].inventory = inventory;
      localStorage.setItem('users', JSON.stringify(users));
    }

    function addRobux(amount) {
      robux += amount;
      updateUI();
    }

    function showSection(id) {
      document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
    }

    function searchFriend() {
      const query = document.getElementById('friendSearch').value;
      if (users[query] && query !== currentUser) {
        alert(`${query} encontrado!`);
      } else {
        alert('Usuario no encontrado');
      }
    }

    renderItems();
  </script>
</body>
</html>
