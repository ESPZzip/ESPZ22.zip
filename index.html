<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>ESP:Z</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f4f4f4; }
    .hidden { display: none; }
    header { background: #222; color: #fff; padding: 10px; display: flex; justify-content: space-between; }
    nav button { margin: 5px; padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; }
    .content { padding: 20px; }
    .item-card { display: inline-block; margin: 10px; padding: 10px; border: 1px solid #ccc; border-radius: 10px; width: 150px; background: white; text-align: center; }
    .admin-panel { position: fixed; top: 10%; left: 50%; transform: translateX(-50%); background: white; padding: 20px; border: 2px solid #333; border-radius: 10px; width: 400px; z-index: 999; }
    .admin-panel h3 { margin-top: 0; }
    .admin-panel input { display: block; margin: 8px 0; padding: 6px; width: 95%; }
    .admin-panel button { margin-top: 5px; padding: 6px 12px; cursor: pointer; }
  </style>
</head>
<body>
  <div id="loginScreen">
    <h2>ESP:Z</h2>
    <input id="username" placeholder="Usuario">
    <input id="password" type="password" placeholder="Contraseña">
    <button onclick="register()">Registrarse</button>
    <button onclick="login()">Iniciar Sesión</button>
  </div>

  <div id="mainScreen" class="hidden">
    <header>
      <div id="playerName"></div>
      <div>Robux: <span id="playerRobux"></span></div>
    </header>
    <nav>
      <button onclick="showSection('marketplace')">Marketplace</button>
      <button onclick="showSection('inventory')">Inventory</button>
      <button onclick="showSection('profile')">Profile</button>
      <button onclick="logout()">Cerrar Sesión</button>
    </nav>
    <div class="content">
      <div id="marketplace" class="section"></div>
      <div id="inventory" class="section hidden"><div id="inventoryContainer"></div></div>
      <div id="profile" class="section hidden"><div id="profileContainer"></div></div>
    </div>
  </div>

  <!-- Panel Admin -->
  <div id="adminPanel" class="admin-panel hidden">
    <h3>Admin Panel</h3>

    <h4>Dar Robux a mí mismo</h4>
    <input id="adminRobuxAmount" type="number" placeholder="Cantidad de Robux">
    <button onclick="giveRobuxSelf()">Agregar Robux</button>

    <h4>Dar Robux a un usuario</h4>
    <input id="targetUser" placeholder="Usuario">
    <input id="targetRobux" type="number" placeholder="Cantidad de Robux">
    <button onclick="giveRobuxUser()">Dar Robux</button>

    <h4>Agregar ítem al Marketplace</h4>
    <input id="newItemId" placeholder="ID del ítem">
    <input id="newItemName" placeholder="Nombre del ítem">
    <input id="newItemPrice" type="number" placeholder="Precio en Robux">
    <input id="newItemStock" type="number" placeholder="Stock">
    <input id="newItemImg" placeholder="URL de la imagen">
    <button onclick="addItem()">Agregar Ítem</button>

    <h4>Eliminar ítem del Marketplace</h4>
    <input id="removeItemId" placeholder="ID o Nombre del ítem">
    <button onclick="removeItem()">Eliminar ítem</button>

    <h4>Historial de acciones</h4>
    <ul id="adminLog"></ul>

    <button onclick="closeAdminPanel()">Cerrar</button>
  </div>

  <script>
    // ===== Utils =====
    function getUsers(){ return JSON.parse(localStorage.getItem("users")||"{}"); }
    function saveUsers(users){ localStorage.setItem("users", JSON.stringify(users)); }
    function getItems(){ return JSON.parse(localStorage.getItem("items")||"[]"); }
    function saveItems(items){ localStorage.setItem("items", JSON.stringify(items)); }

    // ===== Registro/Login =====
    function register(){
      const u=document.getElementById("username").value.trim();
      const p=document.getElementById("password").value.trim();
      if(!u||!p){ alert("Completa todos los campos"); return; }
      let users=getUsers();
      if(users[u]){ alert("Ese usuario ya existe"); return; }
      users[u]={password:p,robux:100,inventory:[]};
      saveUsers(users);
      alert("Usuario registrado con éxito.");
    }
    function login(){
      const u=document.getElementById("username").value.trim();
      const p=document.getElementById("password").value.trim();
      let users=getUsers();
      if(!users[u]||users[u].password!==p){ alert("Usuario o contraseña incorrectos"); return; }
      localStorage.setItem("currentUser",u);
      document.getElementById("loginScreen").classList.add("hidden");
      document.getElementById("mainScreen").classList.remove("hidden");
      loadUser();
    }
    function logout(){
      localStorage.removeItem("currentUser");
      location.reload();
    }

    // ===== Pantallas =====
    function loadUser(){
      const u=localStorage.getItem("currentUser");
      let users=getUsers();
      document.getElementById("playerName").textContent=u;
      document.getElementById("playerRobux").textContent=users[u].robux;
      renderMarketplace(); renderInventory(); renderProfile();
    }
    function showSection(id){
      document.querySelectorAll(".section").forEach(s=>s.classList.add("hidden"));
      document.getElementById(id).classList.remove("hidden");
      if(id==="inventory") renderInventory();
      if(id==="profile") renderProfile();
    }

    // ===== Marketplace =====
    function renderMarketplace(){
      const c=document.getElementById("marketplace"); c.innerHTML="";
      const items=getItems();
      items.forEach(item=>{
        const d=document.createElement("div"); d.className="item-card";
        d.innerHTML=`<img src="${item.img}" width="80"><h4>${item.name}</h4>
        <p>${item.price} Robux</p><p>Stock: ${item.stock}</p>
        <button onclick="buyItem('${item.id}')">Comprar</button>`;
        c.appendChild(d);
      });
    }
    function buyItem(id){
      const u=localStorage.getItem("currentUser");
      let users=getUsers(); let user=users[u];
      let items=getItems(); const idx=items.findIndex(i=>i.id===id);
      if(idx===-1){ alert("Ítem no encontrado"); return; }
      const item=items[idx];
      if(user.robux<item.price){ alert("Robux insuficientes"); return; }
      if(item.stock<=0){ alert("Ítem agotado"); return; }
      user.robux-=item.price; user.inventory.push(id); items[idx].stock--;
      saveUsers(users); saveItems(items);
      document.getElementById("playerRobux").textContent=user.robux;
      renderMarketplace(); renderInventory();
      alert("Has comprado "+item.name+"!");
    }

    // ===== Inventory =====
    function renderInventory(){
      const c=document.getElementById("inventoryContainer"); c.innerHTML="";
      const u=localStorage.getItem("currentUser");
      const users=getUsers(); const items=getItems(); const inv=users[u].inventory||[];
      if(inv.length===0){ c.innerHTML="<p>No tienes ítems.</p>"; return; }
      inv.forEach(it=>{
        const item=items.find(i=>i.id===it);
        if(item){
          const d=document.createElement("div"); d.className="item-card";
          d.innerHTML=`<img src="${item.img}" width="80"><h4>${item.name}</h4>`;
          c.appendChild(d);
        }
      });
    }

    // ===== Profile =====
    function renderProfile(){
      const c=document.getElementById("profileContainer"); c.innerHTML="";
      const u=localStorage.getItem("currentUser"); c.innerHTML=`<h3>Perfil de ${u}</h3>`;
      renderInventory();
    }

    // ===== Admin Panel =====
    function logAction(txt){
      const li=document.createElement("li"); li.textContent=txt;
      document.getElementById("adminLog").appendChild(li);
    }
    function giveRobuxSelf(){
      const amt=parseInt(document.getElementById("adminRobuxAmount").value)||0;
      const u=localStorage.getItem("currentUser"); let users=getUsers(); users[u].robux+=amt;
      saveUsers(users); document.getElementById("playerRobux").textContent=users[u].robux;
      logAction(`+${amt} Robux a ${u}`);
    }
    function giveRobuxUser(){
      const target=document.getElementById("targetUser").value.trim();
      const amt=parseInt(document.getElementById("targetRobux").value)||0;
      let users=getUsers();
      if(!users[target]){ alert("Usuario no encontrado"); return; }
      users[target].robux+=amt; saveUsers(users);
      logAction(`+${amt} Robux a ${target}`);
      alert("Se han dado Robux a "+target);
    }
    function addItem(){
      const id=document.getElementById("newItemId").value.trim();
      const name=document.getElementById("newItemName").value.trim();
      const price=parseInt(document.getElementById("newItemPrice").value)||0;
      const stock=parseInt(document.getElementById("newItemStock").value)||0;
      const img=document.getElementById("newItemImg").value.trim()||"https://via.placeholder.com/80";
      let items=getItems(); if(items.find(i=>i.id===id)){ alert("Ya existe un ítem con ese ID"); return; }
      items.push({id,name,price,stock,img}); saveItems(items); renderMarketplace();
      logAction(`Nuevo ítem agregado: ${name} (${id})`);
    }
    function removeItem(){
      const query=document.getElementById("removeItemId").value.trim().toLowerCase();
      if(!query){ alert("Debes escribir el ID o nombre del ítem."); return; }
      let items=getItems();
      const idx=items.findIndex(it=>it.id.toLowerCase()===query||it.name.toLowerCase()===query);
      if(idx===-1){ alert("Ítem no encontrado"); return; }
      const removed=items.splice(idx,1)[0]; saveItems(items); renderMarketplace();
      logAction(`Ítem eliminado: ${removed.name} (${removed.id})`);
      alert("Ítem eliminado correctamente.");
    }
    function closeAdminPanel(){ document.getElementById("adminPanel").classList.add("hidden"); }
    document.addEventListener("keydown",e=>{
      if(e.key==="F9"){ const u=localStorage.getItem("currentUser");
        if(u==="ROBLOX"){ document.getElementById("adminPanel").classList.toggle("hidden"); }
      }
    });
  </script>
</body>
</html>
