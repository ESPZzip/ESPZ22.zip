<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Registro, Login y Tradeos</title>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      background: #f2f2f2; 
      margin: 0;
      display: flex; 
      height: 100vh; 
    }
    .container { 
      background: white; 
      padding: 20px; 
      border-radius: 10px; 
      width: 300px; 
      box-shadow: 0 0 10px rgba(0,0,0,0.2); 
      margin: auto; 
    }
    h2 { text-align: center; }
    input { width: 100%; padding: 10px; margin: 5px 0; }
    button { padding: 5px 10px; margin: 3px; cursor: pointer; border: none; border-radius: 5px; }
    .btn-register { background: #4CAF50; color: white; width: 100%; }
    .btn-login { background: #2196F3; color: white; width: 100%; }
    #welcome { display: none; text-align: center; }
    
    /* Panel lateral */
    #sidebar {
      width: 250px;
      background: #fff;
      border-left: 2px solid #ccc;
      padding: 10px;
      overflow-y: auto;
    }
    #sidebar h3 {
      text-align: center;
      border-bottom: 1px solid #ccc;
      padding-bottom: 5px;
    }
    .user-item {
      padding: 8px;
      margin: 5px 0;
      border-radius: 5px;
      background: #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .current-user {
      background: #4CAF50;
      color: white;
      font-weight: bold;
    }
    .trade-btn {
      background: #FF9800;
      color: white;
      font-size: 12px;
    }
  </style>
</head>
<body>

<div style="flex:1; display:flex; justify-content:center; align-items:center;">
  <div class="container" id="authBox">
    <h2>Registro / Login</h2>
    <input type="text" id="username" placeholder="Usuario">
    <input type="password" id="password" placeholder="Contraseña">
    <button class="btn-register" onclick="register()">Registrarse</button>
    <button class="btn-login" onclick="login()">Iniciar Sesión</button>
  </div>

  <div class="container" id="welcome">
    <h2 id="welcomeMsg"></h2>
    <p>Robux: <span id="userRobux"></span></p>
    <button onclick="logout()">Cerrar Sesión</button>
  </div>
</div>

<!-- Panel lateral -->
<div id="sidebar">
  <h3>Jugadores</h3>
  <div id="usersList"></div>
</div>

<script>
  function getUsers() {
    return JSON.parse(localStorage.getItem("users") || "{}");
  }

  function saveUsers(users) {
    localStorage.setItem("users", JSON.stringify(users));
  }

  function register() {
    let username = document.getElementById("username").value.trim();
    let password = document.getElementById("password").value.trim();

    if (!username || !password) {
      alert("Por favor completa todos los campos.");
      return;
    }

    let users = getUsers();

    if (users[username]) {
      alert("Ese usuario ya está registrado.");
      return;
    }

    users[username] = { password: password, robux: 100, trades: [] };
    saveUsers(users);
    alert("Registro exitoso. Ahora puedes iniciar sesión.");
    renderUsers();
  }

  function login() {
    let username = document.getElementById("username").value.trim();
    let password = document.getElementById("password").value.trim();

    let users = getUsers();

    if (!users[username]) {
      alert("Usuario no encontrado.");
      return;
    }

    if (users[username].password !== password) {
      alert("Contraseña incorrecta.");
      return;
    }

    localStorage.setItem("currentUser", username);
    loadUser();
    checkTrades();
  }

  function loadUser() {
    let currentUser = localStorage.getItem("currentUser");
    if (!currentUser) return;

    let users = getUsers();
    document.getElementById("authBox").style.display = "none";
    document.getElementById("welcome").style.display = "block";
    document.getElementById("welcomeMsg").innerText = "Bienvenido, " + currentUser;
    document.getElementById("userRobux").innerText = users[currentUser].robux;

    renderUsers();
  }

  function logout() {
    localStorage.removeItem("currentUser");
    document.getElementById("authBox").style.display = "block";
    document.getElementById("welcome").style.display = "none";
    renderUsers();
  }

  function renderUsers() {
    let users = getUsers();
    let currentUser = localStorage.getItem("currentUser");
    let container = document.getElementById("usersList");
    container.innerHTML = "";

    Object.keys(users).forEach(user => {
      let div = document.createElement("div");
      div.className = "user-item";
      if (user === currentUser) {
        div.classList.add("current-user");
        div.textContent = user;
      } else {
        div.innerHTML = `
          <span>${user}</span>
          <button class="trade-btn" onclick="sendTrade('${user}')">Trade</button>
        `;
      }
      container.appendChild(div);
    });
  }

  function sendTrade(targetUser) {
    let currentUser = localStorage.getItem("currentUser");
    if (!currentUser) {
      alert("Debes iniciar sesión para enviar tradeos.");
      return;
    }

    let users = getUsers();

    if (!users[targetUser]) {
      alert("Ese usuario no existe.");
      return;
    }

    users[targetUser].trades.push({ from: currentUser, status: "pendiente" });
    saveUsers(users);

    alert("Has enviado un trade a " + targetUser);
  }

  function checkTrades() {
    let currentUser = localStorage.getItem("currentUser");
    if (!currentUser) return;

    let users = getUsers();
    let trades = users[currentUser].trades || [];

    trades.forEach((trade, index) => {
      if (trade.status === "pendiente") {
        let accept = confirm(trade.from + " te ha enviado un trade. ¿Aceptar?");
        if (accept) {
          trades[index].status = "aceptado";
          alert("Trade aceptado.");
        } else {
          trades[index].status = "rechazado";
          alert("Trade rechazado.");
        }
      }
    });

    users[currentUser].trades = trades;
    saveUsers(users);
  }

  window.onload = () => {
    loadUser();
    renderUsers();
    checkTrades();
  };
</script>

</body>
</html>
