<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Roblox Clone</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f2f2f2; }
    header { background: #333; color: white; padding: 10px; display: flex; justify-content: space-between; }
    nav button { margin: 5px; }
    .section { display: none; padding: 20px; }
    .active { display: block; }
    .item-card { display: inline-block; border: 1px solid #ccc; padding: 10px; margin: 10px; background: white; border-radius: 10px; }
    .card { border: 1px solid #ddd; padding: 10px; margin: 10px; border-radius: 10px; background: #fff; }
    #adminPanel { display: none; position: fixed; top: 10%; left: 20%; width: 60%; background: white; border: 2px solid #333; padding: 20px; z-index: 1000; }
    #loginSection { display: none; text-align: center; padding: 50px; }
    #loginSection input { margin: 5px; padding: 8px; }
    #loginSection button { padding: 8px 15px; }
  </style>
</head>
<body>
  <header>
    <div id="playerName"></div>
    <div>Robux: <span id="playerRobux">0</span></div>
  </header>

  <!-- Registro / Login -->
  <div id="loginSection">
    <h2>Registrarse / Iniciar sesión</h2>
    <input id="usernameInput" placeholder="Nombre de usuario">
    <br>
    <button onclick="registerUser()">Registrarse</button>
  </div>

  <nav id="mainNav" style="display:none;">
    <button onclick="showSection('trades')">Trades</button>
    <button onclick="showSection('inventory')">Inventory</button>
    <button onclick="showSection('marketplace')">Marketplace</button>
    <button onclick="showSection('profile')">Profile</button>
    <button onclick="showSection('friends')">Friends</button>
  </nav>

  <main>
    <div id="trades" class="section">Sistema de trades pronto...</div>
    <div id="inventory" class="section">
      <h2>Inventario</h2>
      <div id="inventoryContainer"></div>
    </div>
    <div id="marketplace" class="section">
      <h2>Marketplace</h2>
      <div id="marketContainer"></div>
    </div>
    <div id="profile" class="section">
      <h2>Perfil</h2>
      <div id="profileContainer"></div>
    </div>
    <div id="friends" class="section">
      <h2>Amigos</h2>
      <input id="searchFriend" placeholder="Buscar usuario">
      <button onclick="searchFriend()">Buscar</button>
      <div id="friendResults"></div>
    </div>
  </main>

  <!-- Panel de Admin -->
  <div id="adminPanel">
    <h2>Panel de Admin</h2>

    <h4>Agregar Robux a mí mismo</h4>
    <input type="number" id="selfRobux" placeholder="Cantidad">
    <button onclick="addRobuxSelf()">Agregar</button>

    <h4>Dar Robux a Usuario</h4>
    <input id="targetUser" placeholder="Nombre de usuario">
    <input type="number" id="targetRobux" placeholder="Cantidad">
    <button onclick="giveRobuxToUser()">Dar Robux</button>

    <hr>
    <h4>Agregar ítem al Marketplace (GLOBAL)</h4>
    <input id="newItemName" placeholder="Nombre del ítem">
    <input id="newItemImg" placeholder="URL de imagen">
    <input type="number" id="newItemPrice" placeholder="Precio en Robux">
    <input type="number" id="newItemStock" placeholder="Stock">
    <button onclick="addItem()">Agregar ítem</button>

    <hr>
    <h4>Eliminar ítem del Marketplace</h4>
    <input id="removeItemId" placeholder="ID o Nombre del ítem">
    <button onclick="removeItem()">Eliminar ítem</button>

    <hr>
    <h4>Historial de acciones</h4>
    <div id="adminLog"></div>

    <button onclick="closeAdminPanel()">Cerrar</button>
  </div>

  <script>
    // ------------------ Datos ------------------
    function getUsers(){ return JSON.parse(localStorage.getItem("users")||"{}"); }
    function saveUsers(u){ localStorage.setItem("users",JSON.stringify(u)); }
    function getItems(){ return JSON.parse(localStorage.getItem("items")||"[]"); }
    function saveItems(i){ localStorage.setItem("items",JSON.stringify(i)); }

    // ------------------ Registro ------------------
    function registerUser(){
      const username=document.getElementById("usernameInput").value.trim();
      if(!username){alert("Ingresa un nombre de usuario.");return;}
      let users=getUsers();
      if(!users[username]){ users[username]={robux:100,inventory:[]}; } // nuevo usuario
      saveUsers(users);
      localStorage.setItem("currentUser",username);
      loadGame();
    }

    // ------------------ Navegación ------------------
    function showSection(id){
      document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
      document.getElementById(id).classList.add("active");
      if(id==="inventory") renderInventory();
      if(id==="marketplace") renderMarketplace();
      if(id==="profile") renderProfile();
    }

    // ------------------ Inventory ------------------
    function renderInventory(){
      const c=document.getElementById("inventoryContainer"); 
      c.innerHTML="";
      const u=localStorage.getItem("currentUser");
      const users=getUsers(); 
      const items=getItems(); 
      const inv=users[u].inventory||[];

      if(inv.length===0){ 
        c.innerHTML="<p>No tienes ítems.</p>"; 
        return; 
      }

      inv.forEach(it=>{
        const item=items.find(i=>i.id===it);
        const d=document.createElement("div"); 
        d.className="item-card";

        if(item){
          d.innerHTML=`<img src="${item.img}" width="80"><h4>${item.name}</h4>`;
        } else {
          d.innerHTML=`<img src="https://via.placeholder.com/80?text=Retirado" width="80">
                       <h4>Edición retirada</h4>`;
        }

        c.appendChild(d);
      });
    }

    // ------------------ Marketplace ------------------
    function renderMarketplace(){
      const c=document.getElementById("marketContainer");
      c.innerHTML="";
      const items=getItems();
      items.forEach(it=>{
        const d=document.createElement("div");
        d.className="item-card";
        d.innerHTML=`<img src="${it.img}" width="80">
                     <h4>${it.name}</h4>
                     <p>${it.price} Robux</p>
                     <p>Stock: ${it.stock}</p>
                     <button onclick="buyItem('${it.id}')">Comprar</button>`;
        c.appendChild(d);
      });
    }

    function buyItem(id){
      const u=localStorage.getItem("currentUser");
      const users=getUsers();
      const items=getItems();
      const item=items.find(i=>i.id===id);

      if(!item||item.stock<=0){alert("Item no disponible.");return;}
      if(users[u].robux<item.price){alert("Robux insuficientes.");return;}

      users[u].robux-=item.price;
      users[u].inventory.push(item.id);
      item.stock--;

      saveUsers(users);
      saveItems(items);
      document.getElementById("playerRobux").textContent=users[u].robux;
      alert(`Has comprado ${item.name}`);
      renderInventory();
      renderMarketplace();
    }

    // ------------------ Profile ------------------
    function renderProfile(){
      const c=document.getElementById("profileContainer");
      c.innerHTML="";
      const u=localStorage.getItem("currentUser");
      const users=getUsers();
      c.innerHTML=`<h3>${u}</h3><p>Robux: ${users[u].robux}</p>`;
    }

    // ------------------ Admin Panel ------------------
    function openAdminPanel(){
      document.getElementById("adminPanel").style.display="block";
    }
    function closeAdminPanel(){
      document.getElementById("adminPanel").style.display="none";
    }
    function logAction(txt){
      document.getElementById("adminLog").innerHTML+=`<p>${txt}</p>`;
    }

    function addRobuxSelf(){
      const u=localStorage.getItem("currentUser");
      const users=getUsers();
      const amt=parseInt(document.getElementById("selfRobux").value);
      if(amt>0){users[u].robux+=amt;saveUsers(users);document.getElementById("playerRobux").textContent=users[u].robux;logAction(`${u} se dio ${amt} Robux`);}
    }

    function giveRobuxToUser(){
      const usernameInput=document.getElementById("targetUser").value.trim();
      const robuxToGive=parseInt(document.getElementById("targetRobux").value);
      if(!usernameInput||isNaN(robuxToGive)||robuxToGive<=0){alert("Datos inválidos");return;}
      let users=getUsers();
      let foundUserKey=Object.keys(users).find(k=>k.toLowerCase()===usernameInput.toLowerCase());
      if(!foundUserKey){alert("Ese usuario no existe.");return;}
      users[foundUserKey].robux+=robuxToGive;
      saveUsers(users);
      logAction(`Se dieron ${robuxToGive} Robux a ${foundUserKey}`);
      alert(`Has dado ${robuxToGive} Robux a ${foundUserKey}`);
    }

    function addItem(){
      const name=document.getElementById("newItemName").value.trim();
      const img=document.getElementById("newItemImg").value.trim();
      const price=parseInt(document.getElementById("newItemPrice").value);
      const stock=parseInt(document.getElementById("newItemStock").value);
      if(!name||!img||isNaN(price)||isNaN(stock)){alert("Datos inválidos");return;}
      const items=getItems();
      const id=name.toLowerCase().replace(/\s+/g,"_")+"_"+Date.now();
      items.push({id,name,img,price,stock});
      saveItems(items);
      logAction(`Se agregó ítem global: ${name}`);
      renderMarketplace();
    }

    function removeItem(){
      const id=document.getElementById("removeItemId").value.trim().toLowerCase();
      let items=getItems();
      const idx=items.findIndex(it=>it.id.toLowerCase()===id||it.name.toLowerCase()===id);
      if(idx===-1){alert("Ítem no encontrado");return;}
      let removed=items[idx].name;
      items.splice(idx,1);
      saveItems(items);
      logAction(`Se eliminó del catálogo: ${removed}`);
      renderMarketplace();
    }

    // ------------------ Inicialización ------------------
    function loadGame(){
      document.getElementById("loginSection").style.display="none";
      document.getElementById("mainNav").style.display="block";

      const u=localStorage.getItem("currentUser");
      const users=getUsers();
      if(!users[u]){users[u]={robux:0,inventory:[]};saveUsers(users);}
      document.getElementById("playerName").textContent=u;
      document.getElementById("playerRobux").textContent=users[u].robux;
      showSection("marketplace");
    }

    window.onload=function(){
      const u=localStorage.getItem("currentUser");
      if(!u){
        document.getElementById("loginSection").style.display="block";
      } else {
        loadGame();
      }
    }

    // Abrir admin panel con F9 solo si eres ROBLOX
    document.addEventListener("keydown",e=>{
      if(e.key==="F9"){
        const u=localStorage.getItem("currentUser");
        if(u==="ROBLOX") openAdminPanel();
      }
    });
  </script>
</body>
</html>
