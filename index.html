<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>ESPZ</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f4f4f4; }
    header { background: #4CAF50; color: white; padding: 10px; text-align: center; }
    #saldo { font-weight: bold; }
    .container { padding: 20px; display: grid; grid-template-columns: repeat(auto-fill, minmax(200px,1fr)); gap: 20px; }
    .item { background: white; border-radius: 10px; padding: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); position: relative; }
    .item h3 { margin: 0 0 10px 0; }
    .item button { background: #4CAF50; border: none; color: white; padding: 8px; border-radius: 6px; cursor: pointer; }
    .item button:disabled { background: grey; cursor: not-allowed; }
    #carrito { position: fixed; right: 0; top: 0; background: white; height: 100%; width: 300px; box-shadow: -2px 0 5px rgba(0,0,0,0.2); padding: 20px; overflow-y: auto; }
    #carrito h2 { margin-top: 0; }
    .limitado { position: absolute; top: 10px; left: 10px; background: gold; color: black; font-weight: bold; padding: 2px 6px; border-radius: 5px; font-size: 12px; }
    dialog { border: none; border-radius: 8px; padding: 20px; }
    dialog input { display:block; margin-bottom:10px; width:100%; padding:5px; }
    dialog button { margin-top:5px; }
  </style>
</head>
<body>
  <header>
    <h1>ESPZ</h1>
    <p>Saldo: <span id="saldo">0</span> Robux</p>
  </header>

  <main class="container" id="tienda"></main>

  <aside id="carrito">
    <h2>Carrito</h2>
    <ul id="carritoLista"></ul>
    <p>Total: <span id="total">0</span> Coins</p>
    <button onclick="comprar()">Comprar</button>
  </aside>

  <dialog id="adminDialog">
    <h3>Agregar √çtem Limitado</h3>
    <input type="text" id="newNombre" placeholder="Nombre del √≠tem">
    <input type="number" id="newPrecio" placeholder="Precio">
    <input type="number" id="newStock" placeholder="Stock">
    <button onclick="agregarItemLimitado()">Agregar</button>
    <button onclick="document.getElementById('adminDialog').close()">Cerrar</button>
  </dialog>

  <script>
    let saldo = parseInt(localStorage.getItem('saldo')) || 1000;
    let inventario = JSON.parse(localStorage.getItem('inventario')) || [];
    let itemsBase = JSON.parse(localStorage.getItem('catalogo')) || [
      { nombre: "Espada", precio: 200, stock: Infinity, limitado: false },
      { nombre: "Escudo", precio: 150, stock: Infinity, limitado: false }
    ];

    let carrito = [];

    function renderTienda() {
      const tienda = document.getElementById("tienda");
      tienda.innerHTML = "";
      itemsBase.forEach((item, i) => {
        const div = document.createElement("div");
        div.className = "item";

        if(item.limitado) {
          const badge = document.createElement("div");
          badge.className = "limitado";
          badge.textContent = "Limitado";
          div.appendChild(badge);
        }

        div.innerHTML += `<h3>${item.nombre}</h3>
          <p>Precio: ${item.precio} Coins</p>
          <p>Stock: ${item.stock === Infinity ? '‚àû' : item.stock}</p>`;
        const btn = document.createElement("button");
        btn.textContent = "Agregar al carrito";
        btn.onclick = () => addToCarrito(i);
        if(item.stock !== Infinity && item.stock <= 0) btn.disabled = true;
        div.appendChild(btn);
        tienda.appendChild(div);
      });
      document.getElementById("saldo").textContent = saldo;
    }

    function renderCarrito() {
      const lista = document.getElementById("carritoLista");
      lista.innerHTML = "";
      let total = 0;
      carrito.forEach((item, i) => {
        const li = document.createElement("li");
        li.textContent = `${item.nombre} - ${item.precio} Coins`;
        total += item.precio;
        lista.appendChild(li);
      });
      document.getElementById("total").textContent = total;
    }

    function addToCarrito(index) {
      const item = itemsBase[index];
      if(item.stock !== Infinity && item.stock <= 0) return;
      carrito.push(item);
      if(item.stock !== Infinity) item.stock--;
      renderTienda();
      renderCarrito();
      localStorage.setItem('catalogo', JSON.stringify(itemsBase));
    }

    function comprar() {
      let total = carrito.reduce((sum, item) => sum + item.precio, 0);
      if(total > saldo) {
        alert("No tienes suficientes Coins");
        return;
      }
      saldo -= total;
      inventario = inventario.concat(carrito);
      carrito = [];
      localStorage.setItem('saldo', saldo);
      localStorage.setItem('inventario', JSON.stringify(inventario));
      renderTienda();
      renderCarrito();
      alert("Compra realizada");
    }

    function agregarItemLimitado() {
      const nombre = document.getElementById("newNombre").value;
      const precio = parseInt(document.getElementById("newPrecio").value);
      const stock = parseInt(document.getElementById("newStock").value);
      if(!nombre || !precio || !stock) return alert("Completa todos los campos");
      itemsBase.push({ nombre, precio, stock, limitado: true });
      localStorage.setItem('catalogo', JSON.stringify(itemsBase));
      document.getElementById("adminDialog").close();
      location.reload(); // üîÑ fuerza recargar la p√°gina para reflejar el nuevo √≠tem
    }

    document.addEventListener("keydown", e => {
      if(e.key === "F9") {
        e.preventDefault();
        document.getElementById("adminDialog").showModal();
      }
    });

    // üîî Si otro admin agrega √≠tems en otra pesta√±a, se actualiza esta autom√°ticamente
    window.addEventListener("storage", (e) => {
      if(e.key === "catalogo") {
        itemsBase = JSON.parse(localStorage.getItem('catalogo')) || [];
        renderTienda();
      }
    });

    renderTienda();
    renderCarrito();
  </script>
</body>
</html>
