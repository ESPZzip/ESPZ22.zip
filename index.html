<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>ESP:Z</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #eee; }
    .login-container { padding: 20px; }
    input { display: block; margin: 10px 0; padding: 5px; }
    button { margin: 5px 0; padding: 6px 12px; border: none; background: #006644; color: white; border-radius: 6px; cursor: pointer; }
    button:hover { background: #009966; }
    button:disabled { background: #999; cursor: not-allowed; }

    .app { display: none; }
    .header { background: #222; color: white; padding: 10px; display: flex; justify-content: space-between; }
    .sidebar { width: 200px; background: #333; color: white; height: calc(100vh - 40px); float: left; padding: 10px; }
    .sidebar button { display: block; width: 100%; margin: 5px 0; background: #444; }
    .content { margin-left: 210px; padding: 20px; }

    .item-card {
      background: white;
      border-radius: 8px;
      padding: 10px;
      margin: 10px;
      width: 180px;
      display: inline-block;
      vertical-align: top;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    .item-card img {
      width: 100px; height: 100px; object-fit: contain;
    }
  </style>
</head>
<body>
  <!-- LOGIN -->
  <div class="login-container" id="loginPage">
    <h2>ESP:Z</h2>
    <input id="username" placeholder="Usuario">
    <input id="password" type="password" placeholder="Contrase침a">
    <button onclick="register()">Registrarse</button>
    <button onclick="login()">Iniciar Sesi칩n</button>
  </div>

  <!-- APP PRINCIPAL -->
  <div class="app" id="app">
    <div class="header">
      <div id="playerName"></div>
      <div>游눯 Robux: <span id="playerRobux">0</span></div>
    </div>
    <div class="sidebar">
      <button onclick="showSection('marketplace')">Marketplace</button>
      <button onclick="showSection('inventory')">Inventory</button>
      <button onclick="showSection('trades')">Trades</button>
      <button onclick="showSection('profile')">Profile</button>
      <button onclick="showSection('friends')">Friends</button>
      <button onclick="logout()">Cerrar Sesi칩n</button>
    </div>
    <div class="content">
      <div id="marketplace" class="section">
        <h2>Marketplace</h2>
        <div id="itemsContainer"></div>
      </div>
      <div id="inventory" class="section" style="display:none;">
        <h2>Inventory</h2>
        <div id="inventoryContainer"></div>
      </div>
      <div id="trades" class="section" style="display:none;">
        <h2>Trades</h2>
        <p>Aqu칤 estar치n tus intercambios.</p>
      </div>
      <div id="profile" class="section" style="display:none;">
        <h2>Perfil</h2>
        <p>Informaci칩n del jugador.</p>
      </div>
      <div id="friends" class="section" style="display:none;">
        <h2>Amigos</h2>
        <p>Lista de amigos y buscador aqu칤.</p>
      </div>
    </div>
  </div>

  <script>
    function getItems() {
      let stored = JSON.parse(localStorage.getItem("items"));
      if (stored) return stored;
      const defaultItems = [
        { id: 1, name: "Dominus Aureus", price: 500, stock: 2, img: "https://tr.rbxcdn.com/30DAY-AvatarHeadshot-420-420.png" },
        { id: 2, name: "Red Sparkle Time Fedora", price: 350, stock: 3, img: "https://tr.rbxcdn.com/30DAY-AvatarBust-420-420.png" },
        { id: 3, name: "Valkyrie Helm", price: 200, stock: 5, img: "https://tr.rbxcdn.com/30DAY-AvatarHeadshot-420-420.png" },
        { id: 4, name: "Clockwork's Shades", price: 150, stock: 1, img: "https://tr.rbxcdn.com/30DAY-AvatarHeadshot-420-420.png" }
      ];
      localStorage.setItem("items", JSON.stringify(defaultItems));
      return defaultItems;
    }
    function saveItems(items) {
      localStorage.setItem("items", JSON.stringify(items));
    }

    function getUsers() {
      return JSON.parse(localStorage.getItem("users") || "{}");
    }
    function saveUsers(users) {
      localStorage.setItem("users", JSON.stringify(users));
    }

    function register() {
      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();
      if (!username || !password) {
        alert("Completa todos los campos");
        return;
      }
      let users = getUsers();
      if (users[username]) {
        alert("Ese usuario ya existe");
        return;
      }
      users[username] = { password, robux: 300, inventory: [], friends: [], requests: [] };
      saveUsers(users);
      localStorage.setItem("currentUser", username);
      loadApp();
    }

    function login() {
      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();
      let users = getUsers();
      if (!users[username] || users[username].password !== password) {
        alert("Usuario o contrase침a incorrectos");
        return;
      }
      localStorage.setItem("currentUser", username);
      loadApp();
    }

    function logout() {
      localStorage.removeItem("currentUser");
      document.getElementById("app").style.display = "none";
      document.getElementById("loginPage").style.display = "block";
    }

    function loadApp() {
      const username = localStorage.getItem("currentUser");
      if (!username) return;
      let users = getUsers();
      const user = users[username];

      document.getElementById("loginPage").style.display = "none";
      document.getElementById("app").style.display = "block";
      document.getElementById("playerName").textContent = "Jugador: " + username;
      document.getElementById("playerRobux").textContent = user.robux;

      renderMarketplace();
      renderInventory();
    }

    function showSection(sectionId) {
      document.querySelectorAll(".section").forEach(s => s.style.display = "none");
      document.getElementById(sectionId).style.display = "block";
    }

    function renderMarketplace() {
      const container = document.getElementById("itemsContainer");
      container.innerHTML = "";
      const items = getItems();
      items.forEach(it => {
        const div = document.createElement("div");
        div.className = "item-card";
        div.innerHTML = `
          <img src="${it.img}" onerror="this.src='https://via.placeholder.com/100'">
          <h4>${it.name}</h4>
          <p>游눯 ${it.price} Robux</p>
          <p>游닍 Stock: ${it.stock}</p>
          <button onclick="buyItem(${it.id})" ${it.stock <= 0 ? "disabled" : ""}>
            ${it.stock > 0 ? "Comprar" : "Agotado"}
          </button>
        `;
        container.appendChild(div);
      });
    }

    function renderInventory() {
      const container = document.getElementById("inventoryContainer");
      container.innerHTML = "";
      const username = localStorage.getItem("currentUser");
      const users = getUsers();
      const items = getItems();
      const inv = users[username].inventory;
      if (inv.length === 0) {
        container.innerHTML = "<p>No tienes 칤tems.</p>";
        return;
      }
      inv.forEach(it => {
        const item = items.find(i => i.id === it);
        if (item) {
          const div = document.createElement("div");
          div.className = "item-card";
          div.innerHTML = `
            <img src="${item.img}" onerror="this.src='https://via.placeholder.com/100'">
            <h4>${item.name}</h4>
            <p>游닍 Stock actual: ${item.stock}</p>
          `;
          container.appendChild(div);
        }
      });
    }

    function buyItem(itemId) {
      const username = localStorage.getItem("currentUser");
      let users = getUsers();
      let user = users[username];
      let items = getItems();
      const itemIndex = items.findIndex(i => i.id === itemId);
      const item = items[itemIndex];

      if (user.robux < item.price) {
        alert("Robux insuficientes");
        return;
      }
      if (user.inventory.includes(itemId)) {
        alert("Ya tienes este 칤tem");
        return;
      }
      if (item.stock <= 0) {
        alert("Este 칤tem est치 agotado");
        return;
      }

      user.robux -= item.price;
      user.inventory.push(itemId);
      items[itemIndex].stock -= 1;

      saveUsers(users);
      saveItems(items);
      loadApp();
      alert("Has comprado " + item.name + "!");
    }

    // Si ya estaba logueado, cargar directo
    window.onload = () => {
      if (localStorage.getItem("currentUser")) {
        loadApp();
      }
    };
  </script>
</body>
</html>
