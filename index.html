<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>ESP:Z COINS - Cajas Roblox</title>
  <style>
    body { font-family: Arial, sans-serif; background:#111; color:#fff; margin:0; padding:0; text-align:center; }
    header { background:#222; padding:15px; font-size:26px; }
    .coins { margin:20px; font-size:22px; }
    .container { display:flex; justify-content:center; gap:30px; margin:20px; flex-wrap:wrap; }
    .box { background:#222; padding:20px; border-radius:15px; width:220px; }
    .box h2 { font-size:18px; margin:10px 0; }
    .box img { width:120px; height:120px; object-fit:contain; border-radius:12px; }
    .box button { margin-top:8px; padding:8px 12px; border:none; border-radius:8px; background:#28a745; color:#fff; cursor:pointer; font-size:14px; display:block; margin-left:auto; margin-right:auto; }
    .inventory { padding:20px; background:#222; margin:20px; border-radius:15px; }
    .inventory h2 { margin-bottom:10px; }
    .inventory .item { display:inline-block; margin:8px; padding:6px 10px; background:#333; border-radius:8px; width:160px; vertical-align:top; }
    .inventory .item img { width:70px; height:70px; object-fit:contain; display:block; margin:0 auto 6px auto; }
    .rarity-com√∫n { color:lightgray; }
    .rarity-raro { color:#4da6ff; }
    .rarity-√©pic { color:#b84dff; }
    .rarity-legendario { color:gold; text-shadow:0 0 8px gold; animation: shine 2s infinite; }
    @keyframes shine { 50% { text-shadow:0 0 16px gold; } }
    .sell-btn { margin-top:5px; padding:4px 8px; font-size:12px; cursor:pointer; background:#c00; border:none; border-radius:5px; color:white; }
    .sell-all-btn { margin-top:10px; padding:8px 12px; font-size:14px; cursor:pointer; background:#e74c3c; border:none; border-radius:8px; color:white; }
    #timerBox { position:fixed; top:15px; right:15px; background:#222; padding:10px 15px; border-radius:10px; border:2px solid #555; font-size:16px; display:flex; align-items:center; gap:6px; }
    #hourglass { animation: spin 2s linear infinite; display:inline-block; }
    @keyframes spin { 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }
    .panel-novedades { background:#222; margin:20px auto; padding:15px; border-radius:12px; width:60%; border:1px solid #555; }
    /* Modal */
    .modal { display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background:rgba(0,0,0,0.7); }
    .modal-content { background:#222; margin:5% auto; padding:20px; border-radius:15px; width:70%; color:#fff; }
    .modal h2 { margin-bottom:15px; }
    .close { float:right; font-size:28px; cursor:pointer; }
    .items-grid { display:flex; flex-wrap:wrap; gap:15px; justify-content:center; }
    .item-card { background:#333; border-radius:10px; padding:10px; width:160px; text-align:center; }
    .item-card img { width:80px; height:80px; object-fit:contain; margin-bottom:8px; }
  </style>
</head>
<body>
  <header>ESP:Z COINS - Cajas Roblox</header>
  <div class="coins">Monedas: <span id="coins">0</span></div>

  <div class="container">
    <div class="box">
      <img src="https://media.discordapp.net/attachments/1412227402414821426/1412580654931251301/P7ryoBP.png" alt="Caja B√°sica">
      <h2>Caja B√°sica - 150 monedas</h2>
      <button onclick="openBox('basic')">Abrir</button>
      <button onclick="showItems('basic')">Ver √≠tems</button>
    </div>
    <div class="box">
      <img src="https://media.discordapp.net/attachments/1412227402414821426/1412574672939126824/TsnB7J6.png" alt="Caja √âpica">
      <h2>Caja √âpica - 1200 monedas</h2>
      <button onclick="openBox('epic')">Abrir</button>
      <button onclick="showItems('epic')">Ver √≠tems</button>
    </div>
    <div class="box">
      <img src="https://media.discordapp.net/attachments/1412227402414821426/1412577203748733038/Ez7wbts.png" alt="Caja Cracky">
      <h2>CAJA CRACKY (Especial) - 100,000 monedas</h2>
      <button onclick="openBox('cracky')">Abrir</button>
      <button onclick="showItems('cracky')">Ver √≠tems</button>
    </div>
  </div>

  <div class="inventory">
    <h2>Inventario</h2>
    <button class="sell-all-btn" onclick="sellAll()">Vender Todo</button>
    <div id="inventoryList"></div>
  </div>

  <div class="panel-novedades">
    <h2>√öltimo √≠tem agregado</h2>
    <div id="ultimoAgregado">Ninguno a√∫n</div>
  </div>

  <div id="timerBox"><span id="hourglass">‚è≥</span> <span id="timer">Cargando...</span></div>

  <!-- Modal -->
  <div id="itemsModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <h2 id="modalTitle">√çtems</h2>
      <div id="modalItems" class="items-grid"></div>
    </div>
  </div>

  <audio id="soundNew" src="https://www.soundjay.com/buttons/sounds/button-3.mp3"></audio>
  <audio id="soundExpire" src="https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3"></audio>

  <script>
    let coins = parseInt(localStorage.getItem('coins')) || 0;
    document.getElementById('coins').innerText = coins;

    const itemsBasic = [
      {name:"Robux Coin", value:100, rarity:"Com√∫n", icon:"‚ö™", prob:50, img:"https://tr.rbxcdn.com/180DAY-1/420/420/Hat/Webp/noFilter"},
      {name:"Noob Character", value:150, rarity:"Com√∫n", icon:"‚ö™", prob:30, img:"https://tr.rbxcdn.com/180DAY-2/420/420/Hat/Webp/noFilter"},
      {name:"Roblox Shirt", value:200, rarity:"Raro", icon:"üîπ", prob:15, img:"https://tr.rbxcdn.com/180DAY-3/420/420/Hat/Webp/noFilter"},
      {name:"Roblox Hat", value:300, rarity:"Raro", icon:"üîπ", prob:5, img:"https://tr.rbxcdn.com/180DAY-4/420/420/Hat/Webp/noFilter"}
    ];

    const itemsEpic = [
      {name:"Epic Roblox Sword", value:800, rarity:"√âpic", icon:"üíé", prob:40, img:"https://tr.rbxcdn.com/180DAY-5/420/420/Hat/Webp/noFilter"},
      {name:"Golden Robux", value:1000, rarity:"√âpic", icon:"üíé", prob:30, img:"https://tr.rbxcdn.com/180DAY-6/420/420/Hat/Webp/noFilter"},
      {name:"Red Valkyrie", value:1200, rarity:"Legendario", icon:"‚≠ê", prob:20, img:"https://tr.rbxcdn.com/180DAY-7/420/420/Hat/Webp/noFilter"},
      {name:"Dominus", value:1500, rarity:"Legendario", icon:"‚≠ê", prob:10, img:"https://tr.rbxcdn.com/180DAY-8/420/420/Hat/Webp/noFilter"}
    ];

    const itemsCracky = [
      {name:"Cracky Hat", value:250000, rarity:"Legendario", icon:"üëë", prob:0.001, img:"https://tr.rbxcdn.com/180DAY-9/420/420/Hat/Webp/noFilter"},
      {name:"Cracky Face", value:10000, rarity:"Raro", icon:"üòÄ", prob:50, img:"https://tr.rbxcdn.com/180DAY-10/420/420/Hat/Webp/noFilter"},
      {name:"Cracky Mods", value:50000, rarity:"√âpic", icon:"üõ†", prob:20, img:"https://tr.rbxcdn.com/180DAY-11/420/420/Hat/Webp/noFilter"}
    ];

    const extraItems = [
      {name:"Rainbow Dominus", value:2000, rarity:"Legendario", icon:"‚≠ê", prob:5, img:"https://tr.rbxcdn.com/180DAY-12/420/420/Hat/Webp/noFilter"},
      {name:"Ban Hammer", value:1800, rarity:"Legendario", icon:"‚≠ê", prob:10, img:"https://tr.rbxcdn.com/180DAY-13/420/420/Hat/Webp/noFilter"},
      {name:"Bloxy Award", value:2200, rarity:"Legendario", icon:"‚≠ê", prob:5, img:"https://tr.rbxcdn.com/180DAY-14/420/420/Hat/Webp/noFilter"}
    ];

    let inventory = JSON.parse(localStorage.getItem('inventory')) || [];

    function weightedRandom(items) {
      let total = items.reduce((sum, i) => sum + i.prob, 0);
      let r = Math.random() * total;
      let acum = 0;
      for (let i of items) {
        acum += i.prob;
        if (r <= acum) return i;
      }
      return items[0];
    }

    function openBox(type){
      let boxItems, cost;
      if(type=="basic"){ boxItems=itemsBasic; cost=150; }
      if(type=="epic"){ boxItems=itemsEpic; cost=1200; }
      if(type=="cracky"){ boxItems=itemsCracky; cost=100000; }
      if(coins < cost){ alert("No tienes suficientes monedas"); return; }
      coins -= cost;
      localStorage.setItem('coins', coins);
      document.getElementById('coins').innerText = coins;
      let won = weightedRandom(boxItems);
      inventory.push(won);
      localStorage.setItem('inventory', JSON.stringify(inventory));
      renderInventory();
      alert(`¬°Ganaste ${won.name}!`);
    }

    function renderInventory(){
      let div = document.getElementById('inventoryList');
      div.innerHTML = '';
      inventory.forEach((item, idx)=>{
        div.innerHTML += `<div class="item rarity-${item.rarity.toLowerCase()}">
          <img src="${item.img}" alt="${item.name}">
          ${item.name} (${item.icon} ${item.rarity})<br>Valor: ${item.value}
          <button class='sell-btn' onclick='sellItem(${idx})'>Vender</button>
        </div>`;
      });
    }

    function sellItem(i){
      let item = inventory[i];
      if(confirm(`¬øVender ${item.name} por ${item.value} monedas?`)){
        coins += item.value;
        inventory.splice(i,1);
        localStorage.setItem('coins', coins);
        localStorage.setItem('inventory', JSON.stringify(inventory));
        document.getElementById('coins').innerText = coins;
        renderInventory();
      }
    }

    function sellAll(){
      if(inventory.length===0){ alert("No tienes √≠tems."); return; }
      if(confirm("¬øVender todos tus √≠tems?")){
        let total = inventory.reduce((sum,i)=>sum+i.value,0);
        coins += total;
        inventory = [];
        localStorage.setItem('coins', coins);
        localStorage.setItem('inventory', JSON.stringify(inventory));
        document.getElementById('coins').innerText = coins;
        renderInventory();
        alert(`Vendiste todo por ${total} monedas`);
      }
    }

    renderInventory();

    // Modal funciones
    function showItems(type){
      let items = [];
      let title = "";
      if(type=="basic"){ items=itemsBasic; title="√çtems de Caja B√°sica"; }
      if(type=="epic"){ items=itemsEpic; title="√çtems de Caja √âpica"; }
      if(type=="cracky"){ items=itemsCracky; title="√çtems de Caja Cracky"; }
      document.getElementById('modalTitle').innerText = title;
      let cont = document.getElementById('modalItems');
      cont.innerHTML = '';
      items.forEach(it=>{
        cont.innerHTML += `<div class="item-card">
          <img src="${it.img}" alt="${it.name}">
          <div><b>${it.name}</b></div>
          <div>${it.icon} ${it.rarity}</div>
          <div>Valor: ${it.value}</div>
          <div>Prob: ${it.prob}%</div>
        </div>`;
      });
      document.getElementById('itemsModal').style.display = "block";
    }

    function closeModal(){
      document.getElementById('itemsModal').style.display = "none";
    }

    window.onclick = function(event){
      if(event.target == document.getElementById('itemsModal')){
        closeModal();
      }
    }

    // Timer 20 min
    let nextUpdate = localStorage.getItem('nextItemUpdate');
    if(!nextUpdate){
      nextUpdate = Date.now() + 20*60*1000;
      localStorage.setItem('nextItemUpdate', nextUpdate);
    } else {
      nextUpdate = parseInt(nextUpdate);
    }

    setInterval(()=>{
      let now = Date.now();
      let diff = nextUpdate - now;
      if(diff <= 0){
        let newItem = weightedRandom(extraItems);
        itemsBasic.push({...newItem, temp:true, expire:Date.now()+60*60*1000});
        itemsEpic.push({...newItem, temp:true, expire:Date.now()+60*60*1000});
        document.getElementById('ultimoAgregado').innerText = `${newItem.name}`;
        document.getElementById('soundNew').play();
        nextUpdate = Date.now() + 20*60*1000;
        localStorage.setItem('nextItemUpdate', nextUpdate);
      }
      let m = Math.floor(diff/60000);
      let s = Math.floor((diff%60000)/1000);
      if(m<0||s<0){m=0;s=0;}
      document.getElementById('timer').innerText = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
    },1000);

    // Expiraci√≥n de √≠tems
    setInterval(()=>{
      let now = Date.now();
      function check(arr){
        for(let i=arr.length-1;i>=0;i--){
          if(arr[i].temp && arr[i].expire<=now){
            inventory.push({...arr[i], name: arr[i].name+" [EXCLUSIVO]"});
            document.getElementById('soundExpire').play();
            arr.splice(i,1);
            localStorage.setItem('inventory', JSON.stringify(inventory));
            renderInventory();
          }
        }
      }
      check(itemsBasic);
      check(itemsEpic);
    },5000);
  </script>
</body>
</html>
