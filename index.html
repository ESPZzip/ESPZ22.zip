<script>
  function renderInventory() {
    const container = document.getElementById("inventoryContainer");
    container.innerHTML = "";
    const username = localStorage.getItem("currentUser");
    const users = getUsers();
    const items = getItems();
    const inv = users[username].inventory;

    if (inv.length === 0) {
      container.innerHTML = "<p>No tienes ítems.</p>";
      return;
    }

    inv.forEach(it => {
      const item = items.find(i => i.id === it);
      if (item) {
        const div = document.createElement("div");
        div.className = "item-card";
        div.innerHTML = `
          <img src="${item.img}" onerror="this.src='https://via.placeholder.com/100'">
          <h4>${item.name}</h4>
        `;
        container.appendChild(div);
      }
    });
  }

  function buyItem(itemId) {
    const username = localStorage.getItem("currentUser");
    let users = getUsers();
    let user = users[username];
    let items = getItems();
    const itemIndex = items.findIndex(i => i.id === itemId);
    const item = items[itemIndex];

    if (user.robux < item.price) {
      alert("Robux insuficientes");
      return;
    }
    if (item.stock <= 0) {
      alert("Este ítem está agotado");
      return;
    }

    // Descuento de robux y stock
    user.robux -= item.price;
    user.inventory.push(itemId);
    items[itemIndex].stock -= 1;

    // Guardar cambios
    saveUsers(users);
    saveItems(items);

    // Refrescar UI
    document.getElementById("playerRobux").textContent = user.robux;
    renderMarketplace();
    renderInventory();

    alert("Has comprado " + item.name + "!");
  }
</script>
